<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hidden Walnuts</title>
    <style>
      body { margin: 0; padding: 0; overflow: hidden; }
      canvas { display: block; width: 100vw; height: 100vh; }
      #character-select {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        font-family: 'Arial', sans-serif;
        min-width: 500px;
        z-index: 3000;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      #character-preview-container {
        width: 100%;
        height: 250px;
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        border-radius: 8px;
        border: 2px solid #8B4513;
        overflow: hidden;
        position: relative;
      }
      #character-preview-canvas {
        width: 100%;
        height: 100%;
        display: block;
      }
      #character-select.hidden {
        display: none;
      }
      #character-select h3 {
        margin: 0 0 20px 0;
        color: #2c5f2d;
        font-size: 24px;
        text-align: center;
      }
      #character-select select {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 2px solid #8B4513;
        border-radius: 6px;
        background: white;
        cursor: pointer;
      }
      #character-select select:focus {
        outline: none;
        border-color: #2c5f2d;
      }
      #char-description {
        background: rgba(139, 69, 19, 0.1);
        padding: 15px;
        border-radius: 6px;
        min-height: 60px;
        font-size: 14px;
        color: #333;
        line-height: 1.5;
      }
      #char-description strong {
        color: #8B4513;
        display: block;
        margin-bottom: 5px;
      }
      #start-btn {
        width: 100%;
        padding: 15px;
        font-size: 18px;
        font-weight: bold;
        background: linear-gradient(135deg, #2c5f2d 0%, #4a8f4d 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(44, 95, 45, 0.3);
      }
      #start-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(44, 95, 45, 0.4);
      }
      #start-btn:active {
        transform: translateY(0);
      }
      #debug-overlay {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        z-index: 1000;
      }
      #debug-overlay.hidden {
        display: none;
      }
      #walnut-hud {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(139, 69, 19, 0.9);
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        font-family: 'Arial', sans-serif;
        font-size: 16px;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      }
      #walnut-hud.hidden {
        display: none;
      }
      #walnut-hud div {
        margin: 5px 0;
      }
      .walnut-icon {
        display: inline-block;
        width: 20px;
        height: 20px;
        background: radial-gradient(circle, #8B4513 0%, #654321 100%);
        border-radius: 50%;
        margin-right: 8px;
        vertical-align: middle;
      }
      .landmark-label {
        position: absolute;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-family: Arial, sans-serif;
        font-size: 12px;
        pointer-events: none;
        white-space: nowrap;
        transform: translate(-50%, -100%);
      }
      #minimap {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 200px;
        height: 200px;
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        z-index: 1000;
      }
      #minimap.hidden {
        display: none;
      }
      #minimap canvas {
        width: 100%;
        height: 100%;
        border-radius: 6px;
      }
      #tutorial-overlay.hidden {
        display: none !important;
      }
      #leaderboard {
        position: absolute;
        top: 10px;
        right: 220px;
        width: 250px;
        background: rgba(44, 95, 45, 0.95);
        color: white;
        padding: 15px;
        border-radius: 8px;
        font-family: 'Arial', sans-serif;
        font-size: 14px;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      }
      #leaderboard.hidden {
        display: none;
      }
      #leaderboard h3 {
        margin: 0 0 10px 0;
        font-size: 18px;
        text-align: center;
        color: #FFD700;
        border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        padding-bottom: 8px;
      }
      #leaderboard-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      #leaderboard-list li {
        padding: 8px;
        margin: 4px 0;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.2s;
      }
      #leaderboard-list li:hover {
        background: rgba(0, 0, 0, 0.3);
      }
      #leaderboard-list li.current-player {
        background: rgba(255, 215, 0, 0.2);
        border: 1px solid rgba(255, 215, 0, 0.5);
      }
      .leaderboard-rank {
        font-weight: bold;
        color: #FFD700;
        min-width: 25px;
      }
      .leaderboard-name {
        flex: 1;
        margin: 0 8px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .leaderboard-score {
        font-weight: bold;
        color: #FFE4B5;
      }
      #leaderboard-toggle {
        position: absolute;
        top: 10px;
        right: 475px;
        background: rgba(44, 95, 45, 0.9);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Arial', sans-serif;
        font-size: 14px;
        font-weight: bold;
        z-index: 1001;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        transition: all 0.2s;
      }
      #leaderboard-toggle:hover {
        background: rgba(44, 95, 45, 1);
        transform: translateY(-1px);
      }
      #leaderboard-toggle.hidden {
        display: none;
      }
      #quick-chat {
        position: absolute;
        bottom: 20px;
        left: 20px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 1000;
      }
      #quick-chat.hidden {
        display: none;
      }
      .chat-button {
        background: rgba(44, 95, 45, 0.9);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Arial', sans-serif;
        font-size: 13px;
        font-weight: bold;
        transition: all 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        min-width: 150px;
        text-align: left;
      }
      .chat-button:hover {
        background: rgba(44, 95, 45, 1);
        transform: translateX(3px);
      }
      #emotes {
        position: absolute;
        bottom: 20px;
        right: 20px;
        display: flex;
        gap: 8px;
        z-index: 1000;
      }
      #emotes.hidden {
        display: none;
      }
      .emote-button {
        background: rgba(139, 69, 19, 0.9);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        width: 50px;
        height: 50px;
        transition: all 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .emote-button:hover {
        background: rgba(139, 69, 19, 1);
        transform: scale(1.1);
      }
      #chat-message-display {
        position: absolute;
        bottom: 200px;
        left: 20px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 10px 15px;
        border-radius: 6px;
        font-family: 'Arial', sans-serif;
        font-size: 14px;
        max-width: 300px;
        display: none;
        z-index: 1001;
      }
      #chat-message-display.show {
        display: block;
        animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
      }
      /* MVP 5: Settings Menu Styles */
      #settings-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2500;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #settings-overlay.hidden {
        display: none;
      }
      #settings-menu {
        background: linear-gradient(135deg, #2c5f2d 0%, #4a8f4d 100%);
        border-radius: 12px;
        padding: 30px;
        max-width: 600px;
        width: 90%;
        box-shadow: 0 12px 32px rgba(0,0,0,0.5);
        font-family: 'Arial', sans-serif;
        color: white;
      }
      #settings-menu h2 {
        margin: 0 0 20px 0;
        font-size: 28px;
        text-align: center;
        color: #FFD700;
      }
      .settings-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid rgba(255,255,255,0.3);
      }
      .settings-tab {
        padding: 10px 20px;
        background: rgba(0,0,0,0.2);
        border: none;
        border-radius: 8px 8px 0 0;
        color: rgba(255,255,255,0.7);
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
      }
      .settings-tab:hover {
        background: rgba(0,0,0,0.3);
        color: white;
      }
      .settings-tab.active {
        background: rgba(255,255,255,0.2);
        color: white;
        border-bottom: 3px solid #FFD700;
      }
      .settings-content {
        display: none;
        padding: 20px;
        background: rgba(0,0,0,0.2);
        border-radius: 8px;
        min-height: 300px;
      }
      .settings-content.active {
        display: block;
      }
      .setting-group {
        margin-bottom: 25px;
      }
      .setting-group label {
        display: block;
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 8px;
        color: #FFE4B5;
      }
      .setting-group input[type="range"] {
        width: 100%;
        height: 8px;
        background: rgba(0,0,0,0.3);
        border-radius: 4px;
        outline: none;
        cursor: pointer;
      }
      .setting-group input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        background: #FFD700;
        border-radius: 50%;
        cursor: pointer;
      }
      .setting-group input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: #FFD700;
        border-radius: 50%;
        cursor: pointer;
        border: none;
      }
      .slider-value {
        display: inline-block;
        min-width: 40px;
        text-align: right;
        font-weight: bold;
        color: white;
        margin-left: 10px;
      }
      .controls-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }
      .control-item {
        background: rgba(0,0,0,0.3);
        padding: 12px;
        border-radius: 6px;
      }
      .control-key {
        display: inline-block;
        background: rgba(255,215,0,0.3);
        padding: 4px 12px;
        border-radius: 4px;
        font-weight: bold;
        color: #FFD700;
        margin-right: 8px;
        min-width: 50px;
        text-align: center;
      }
      .settings-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        justify-content: center;
      }
      .settings-button {
        padding: 12px 30px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
      }
      .settings-button.primary {
        background: rgba(255,215,0,0.9);
        color: #2c5f2d;
      }
      .settings-button.primary:hover {
        background: rgba(255,215,0,1);
        transform: translateY(-2px);
      }
      .settings-button.secondary {
        background: rgba(0,0,0,0.3);
        color: white;
      }
      .settings-button.secondary:hover {
        background: rgba(0,0,0,0.4);
      }
      #settings-toggle {
        position: absolute;
        top: 220px;
        right: 10px;
        background: rgba(44, 95, 45, 0.9);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 6px;
        cursor: pointer;
        font-family: 'Arial', sans-serif;
        font-size: 14px;
        font-weight: bold;
        z-index: 1001;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        transition: all 0.2s;
      }
      #settings-toggle:hover {
        background: rgba(44, 95, 45, 1);
        transform: translateY(-1px);
      }
      #settings-toggle.hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="character-select">
      <h3>Select Your Character</h3>
      <div id="character-preview-container">
        <canvas id="character-preview-canvas"></canvas>
      </div>
      <select id="char-select">
        <optgroup label="Mammals">
          <option value="colobus">Colobus Monkey</option>
          <option value="muskrat">Muskrat</option>
          <option value="pudu">Pudu Deer</option>
        </optgroup>
        <optgroup label="Reptiles">
          <option value="gecko">Gecko</option>
          <option value="taipan">Taipan Snake</option>
        </optgroup>
        <optgroup label="Birds">
          <option value="sparrow">Sparrow</option>
        </optgroup>
        <optgroup label="Aquatic">
          <option value="herring">Herring Fish</option>
          <option value="inkfish">Inkfish Squid</option>
        </optgroup>
      </select>
      <div id="char-description">
        <strong>Colobus Monkey</strong>
        Agile tree dweller with excellent mobility. Perfect for quick movements through the forest canopy.
      </div>
      <button id="start-btn">Start Game</button>
    </div>
    <div id="walnut-hud" class="hidden">
      <div>
        <span class="walnut-icon"></span>
        Walnuts: <span id="walnut-count">3</span>
      </div>
      <div>
        ⭐ Score: <span id="player-score">0</span>
      </div>
      <div>
        📍 Location: <span id="grid-location">M13</span>
      </div>
      <hr style="margin: 8px 0; border: 0; border-top: 1px solid rgba(255,255,255,0.3);">
      <div style="font-size: 12px; font-weight: normal; color: #FFE4B5;">
        <strong>H</strong> to hide (near bush = 1pt, ground = 3pt)<br>
        <strong>Click</strong> walnut to find<br>
        <strong>Others' walnuts</strong> = points + walnut back<br>
        <strong>Your walnuts</strong> = just walnut back
      </div>
    </div>
    <div id="debug-overlay" class="hidden">
      <div>🎮 Position: <span id="player-pos">0, 0, 0</span></div>
      <div>👥 Players: <span id="player-count">0</span></div>
      <div>🌐 Network: <span id="network-status">Disconnected</span></div>
      <div>🆔 ID: <span id="player-id">None</span></div>
      <hr style="margin: 8px 0; border-color: #666;">
      <div style="font-size: 10px; color: #ccc;">
        Press F to show/hide debug<br>
        WASD to move around<br>
        Same spawn: (0, 2, 0)
      </div>
    </div>
    <div id="labels-container"></div>
    <div id="minimap">
      <canvas id="minimap-canvas" width="200" height="200"></canvas>
    </div>
    <button id="leaderboard-toggle" class="hidden">🏆 Leaderboard</button>
    <div id="leaderboard" class="hidden">
      <h3>🏆 Top Players</h3>
      <ul id="leaderboard-list">
        <li>
          <span class="leaderboard-rank">#1</span>
          <span class="leaderboard-name">Loading...</span>
          <span class="leaderboard-score">-</span>
        </li>
      </ul>
    </div>
    <div id="tutorial-overlay" class="hidden" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.85); color: white; padding: 30px 40px; border-radius: 12px; font-family: 'Arial', sans-serif; font-size: 18px; max-width: 500px; text-align: center; z-index: 2000; box-shadow: 0 8px 16px rgba(0,0,0,0.5);">
      <button id="tutorial-close" style="position: absolute; top: 10px; right: 10px; background: transparent; color: white; border: none; font-size: 24px; cursor: pointer; padding: 5px 10px; line-height: 1;">×</button>
      <div id="tutorial-message" style="margin-bottom: 20px; line-height: 1.6;"></div>
      <button id="tutorial-next" style="background: rgba(139, 69, 19, 0.9); color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.3s;">Next</button>
    </div>
    <div id="quick-chat" class="hidden">
      <button class="chat-button" data-message="Nice find!">💬 Nice find!</button>
      <button class="chat-button" data-message="Over here!">📍 Over here!</button>
      <button class="chat-button" data-message="Good hiding spot!">👍 Good hiding spot!</button>
      <button class="chat-button" data-message="Want to team up?">🤝 Want to team up?</button>
    </div>
    <div id="emotes" class="hidden">
      <button class="emote-button" data-emote="wave" title="Wave">👋</button>
      <button class="emote-button" data-emote="point" title="Point">👉</button>
      <button class="emote-button" data-emote="celebrate" title="Celebrate">🎉</button>
    </div>
    <div id="chat-message-display"></div>
    <!-- MVP 5: Settings Menu -->
    <button id="settings-toggle" class="hidden">⚙️ Settings</button>
    <div id="settings-overlay" class="hidden">
      <div id="settings-menu">
        <h2>⚙️ Settings</h2>
        <div class="settings-tabs">
          <button class="settings-tab active" data-tab="audio">🔊 Audio</button>
          <button class="settings-tab" data-tab="controls">🎮 Controls</button>
        </div>
        <div id="audio-tab" class="settings-content active">
          <div class="setting-group">
            <label>
              Master Volume
              <span class="slider-value" id="master-volume-value">100%</span>
            </label>
            <input type="range" id="master-volume" min="0" max="100" value="100">
          </div>
          <div class="setting-group">
            <label>
              SFX Volume
              <span class="slider-value" id="sfx-volume-value">70%</span>
            </label>
            <input type="range" id="sfx-volume" min="0" max="100" value="70">
          </div>
          <div class="setting-group">
            <label>
              Ambient Volume
              <span class="slider-value" id="ambient-volume-value">50%</span>
            </label>
            <input type="range" id="ambient-volume" min="0" max="100" value="50">
          </div>
          <div class="setting-group">
            <label style="display: flex; align-items: center; gap: 10px;">
              <input type="checkbox" id="mute-toggle" style="width: 20px; height: 20px; cursor: pointer;">
              Mute All Audio
            </label>
            <p style="margin: 8px 0 0 0; font-size: 13px; color: #FFE4B5; opacity: 0.8;">
              Shortcut: Press <strong>M</strong> key to toggle mute
            </p>
          </div>
        </div>
        <div id="controls-tab" class="settings-content">
          <div class="setting-group">
            <label>
              Mouse Sensitivity
              <span class="slider-value" id="sensitivity-value">100%</span>
            </label>
            <input type="range" id="mouse-sensitivity" min="25" max="200" value="100">
          </div>
          <div class="setting-group">
            <label>Controls Reference</label>
            <div class="controls-grid">
              <div class="control-item">
                <span class="control-key">W A S D</span> Move
              </div>
              <div class="control-item">
                <span class="control-key">SPACE</span> Jump
              </div>
              <div class="control-item">
                <span class="control-key">H</span> Hide Walnut
              </div>
              <div class="control-item">
                <span class="control-key">CLICK</span> Find Walnut
              </div>
              <div class="control-item">
                <span class="control-key">M</span> Toggle Mute
              </div>
              <div class="control-item">
                <span class="control-key">F</span> Debug Info
              </div>
              <div class="control-item">
                <span class="control-key">L</span> Leaderboard
              </div>
              <div class="control-item">
                <span class="control-key">ESC</span> Settings
              </div>
            </div>
          </div>
        </div>
        <div class="settings-buttons">
          <button class="settings-button primary" id="settings-apply">Apply & Close</button>
          <button class="settings-button secondary" id="settings-cancel">Cancel</button>
        </div>
      </div>
    </div>
    <canvas id="gameCanvas" class="hidden"></canvas>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>