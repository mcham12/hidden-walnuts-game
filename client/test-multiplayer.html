<!DOCTYPE html>
<html>
<head><title>Multiplayer Test</title></head>
<body>
  <input id="squirrelId" placeholder="Squirrel ID" />
  <button onclick="connect()">Join</button>
  <button onclick="send()">Send Test</button>
  <pre id="log"></pre>

  <script>
    let socket;

    async function connect() {
      const squirrelId = document.getElementById('squirrelId').value;

      const res = await fetch('http://localhost:8787/join', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ squirrelId })
      });

      const ws = res.webSocket;
      if (!ws) {
        document.getElementById('log').textContent += '❌ WebSocket upgrade failed.\n';
        return;
      }

      ws.accept();
      socket = ws;

      ws.addEventListener('message', (e) => {
        document.getElementById('log').textContent += 'Received: ' + e.data + '\n';
      });

      ws.addEventListener('close', () => {
        document.getElementById('log').textContent += 'WebSocket closed\n';
      });

      document.getElementById('log').textContent += `✅ Joined as ${squirrelId}\n`;
    }

    function send() {
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify({ type: 'rehidden', from: 'test', payload: {} }));
      } else {
        document.getElementById('log').textContent += '❌ WebSocket not open\n';
      }
    }
  </script>
</body>
</html> 