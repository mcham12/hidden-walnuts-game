name = "hidden-walnuts-game"

# CHEN'S FIX: Correct entry point for workers
main = "workers/dist/worker/api.js"

compatibility_date = "2024-01-01"

# Cloudflare Workers configuration
[env.production]
workers_dev = false

# Durable Objects configuration
[[durable_objects.bindings]]
name = "SQUIRREL_SESSION"
class_name = "SquirrelSession"

[[durable_objects.bindings]]
name = "FOREST_MANAGER"
class_name = "ForestManager"

[[durable_objects.bindings]]
name = "WALNUT_REGISTRY"
class_name = "WalnutRegistry"

[[durable_objects.bindings]]
name = "LEADERBOARD"
class_name = "Leaderboard"

# Environment variables
[vars]
ENVIRONMENT = "production"

[build]
command = "npm run build"

# Enable logging for debugging
[observability.logs]
enabled = true

# Durable Objects migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = [
  "ForestManager",
  "SquirrelSession",
  "WalnutRegistry",
  "Leaderboard"
]

[[migrations]]
tag = "v2"
# Removed ForestManager redefinition to avoid conflict
# If new Durable Objects are needed, add them here with new_sqlite_classes

# Environment variables
[vars]
CYCLE_DURATION_SECONDS = "86400"

[env.preview]
[env.preview.vars]
CYCLE_DURATION_SECONDS = "86400"
[env.preview.durable_objects]
bindings = [
  { name = "FOREST", class_name = "ForestManager" },
  { name = "SQUIRREL", class_name = "SquirrelSession" },
  { name = "WALNUTS", class_name = "WalnutRegistry" },
  { name = "LEADERBOARD", class_name = "Leaderboard" }
]

[env.production]
[env.production.vars]
CYCLE_DURATION_SECONDS = "86400"
[env.production.durable_objects]
bindings = [
  { name = "FOREST", class_name = "ForestManager" },
  { name = "SQUIRREL", class_name = "SquirrelSession" },
  { name = "WALNUTS", class_name = "WalnutRegistry" },
  { name = "LEADERBOARD", class_name = "Leaderboard" }
]