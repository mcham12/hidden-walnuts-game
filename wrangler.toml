name = "hidden-walnuts-game"

# CHEN'S FIX: Correct entry point for workers
main = "workers/dist/worker/api.js"

compatibility_date = "2024-01-01"

[build]
command = "npm run build"

# Enable logging for debugging
[observability.logs]
enabled = true

# Environment variables (merged properly)
[vars]
ENVIRONMENT = "production"
CYCLE_DURATION_SECONDS = "86400"

# Durable Objects configuration
[[durable_objects.bindings]]
name = "SQUIRREL_SESSION"
class_name = "SquirrelSession"

[[durable_objects.bindings]]
name = "FOREST_MANAGER"
class_name = "ForestManager"

[[durable_objects.bindings]]
name = "WALNUT_REGISTRY"
class_name = "WalnutRegistry"

[[durable_objects.bindings]]
name = "LEADERBOARD"
class_name = "Leaderboard"

# Durable Objects migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = [
  "ForestManager",
  "SquirrelSession",
  "WalnutRegistry",
  "Leaderboard"
]

# Environment configurations
[env.preview]
workers_dev = true
[env.preview.vars]
ENVIRONMENT = "preview"
CYCLE_DURATION_SECONDS = "86400"
[env.preview.durable_objects]
bindings = [
  { name = "FOREST", class_name = "ForestManager" },
  { name = "SQUIRREL", class_name = "SquirrelSession" },
  { name = "WALNUTS", class_name = "WalnutRegistry" },
  { name = "LEADERBOARD", class_name = "Leaderboard" }
]

[env.production]
workers_dev = false
[env.production.vars]
ENVIRONMENT = "production"
CYCLE_DURATION_SECONDS = "86400"
[env.production.durable_objects]
bindings = [
  { name = "FOREST", class_name = "ForestManager" },
  { name = "SQUIRREL", class_name = "SquirrelSession" },
  { name = "WALNUTS", class_name = "WalnutRegistry" },
  { name = "LEADERBOARD", class_name = "Leaderboard" }
]